<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>CustoCat</title>
    <link rel="stylesheet" type="text/css" href="style.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  </head>
  <body>

    <div style="display:none">
      <img src="images/head/image1.jpg" class="imgHead" id="headImage" width="300px" height="300px"> 
      <img src="images/legs/image1.jpeg" class="imgLegs" id="legsImage" width="300px" height="300px"> 
      <img src="images/arms/image1.jpg" class="imgArm" id="armsImage" width="300px" height="300px"> 
    </div>

    <br>

    <div>
      <button onclick="nextImage('headImage', 0)" class="btn btn-primary nextCat">
          <span class="glyphicon glyphicon-forward"> Next Cat 
      </button> 
      <button onclick="nextImage('legsImage', 2)" class="btn btn-primary nextOct">
          <span class="glyphicon glyphicon-forward"> Next Octopus 
      </button> 
      <button onclick="nextImage('armsImage', 1)" class="btn btn-primary nextArm">
          <span class="glyphicon glyphicon-forward"> Next Arm 
      </button> 
      
  
      <button onclick="previousImage('headImage', 0)" class="btn btn-info prevCat">
        Previous Cat <span class="glyphicon glyphicon-backward"></span>
      </button>    
      <button onclick="previousImage('legsImage', 2)" class="btn btn-info prevOct">
        Previous Octopus <span class="glyphicon glyphicon-backward"></span>
      </button>
      <button onclick="previousImage('armsImage', 1)" class="btn btn-info prevArm">
        Previous Arm <span class="glyphicon glyphicon-backward"></span>
      </button>
    </div>


    <button onclick="randomiseAll()" class="btn btn-danger random">
      Randomise <span class="glyphicon glyphicon-question-sign"></span>
    </button>
    
    <canvas id="canvas" width="600" height="600">
    </canvas>
    

<script>

  function getFiles() {
    var xmlHttp = new XMLHttpRequest();
    xmlHttp.open("GET", '/files', false); // false for synchronous request
    xmlHttp.send(null);
    return JSON.parse(xmlHttp.responseText);
  }

  var mainArray = getFiles()

  // Counter array that holds the current image for each image array
  var counterArr = [0,0,0,0,0]

  // Element Array - Holds tags matched with array numbers
  var elementArray = [
    ['armsImage', 1],
    ['legsImage', 2],
    ['headImage', 0]
  ]

  var ctx = initialiseCanvas()


  function nextImage(element, arrayNum) {
    // Grab image variable from the document
    var img = document.getElementById(element)
    
    // If the counter is at the end of the array, loop around to the start of the array
    if (counterArr[arrayNum] == mainArray[arrayNum].length - 1) {
      counterArr[arrayNum] = 0
      // Update image source to new value
      img.src = mainArray[arrayNum][0]
      fetchImages()
    }

    // Else increase the counter and update image source
    else {
      counterArr[arrayNum] += 1
      img.src = mainArray[arrayNum][counterArr[arrayNum]]
      fetchImages()
    }
  }


  function previousImage(element, arrayNum) {
    // Grab image variable from the document
    var img = document.getElementById(element)
    
    // If the counter is at 0, loop around to the end of the array
    if (counterArr[arrayNum] == 0) {
      counterArr[arrayNum] = mainArray[arrayNum].length - 1
      // Update image source to new value
      img.src = mainArray[arrayNum][counterArr[arrayNum]]
      fetchImages()
    }

    // Else decrease the counter and update image source
    else {
      counterArr[arrayNum] -= 1
      img.src = mainArray[arrayNum][counterArr[arrayNum]]
      fetchImages()
    }
  }


  function randomiseAll() {
    // Loop through all elements in the all elements array
    for (index in elementArray) {     
      // Grab the arrayNum of the element type
      let arrayNum = elementArray[index][1]

      // Generate random num for an image that isn't the current image
      randomNum = getRandomInt(0, mainArray[arrayNum].length)
      while (randomNum == counterArr[arrayNum]) {
        randomNum = getRandomInt(0, mainArray[arrayNum].length)
      }

      // Set the new image and update the current image in the counterArr
      document.getElementById(elementArray[index][0]).src = mainArray[arrayNum][randomNum]
      fetchImages()
      counterArr[arrayNum] = randomNum
    }
  }
  
  
  // Get a random int value between a min and a max
  function getRandomInt(min, max) {
    return Math.floor(Math.random() * (max - min)) + min;
  }

  function fetchImages() {
    let armsImg = document.getElementById('armsImage')
    armsImg.onload = function () {
      let legsImg = document.getElementById('legsImage')
      legsImg.onload = function () { 
        let headImg = document.getElementById('headImage')
        headImg.onload = function () { 
          drawImages(headImg, legsImg, armsImg)
        }
      }
    }
  }

  function drawImages(imageHead, imageLegs, imageArms) {
    ctx.clearRect(0, 0, canvas.width, canvas.height)
    ctx.drawImage(imageArms, 40, 150, 300, 300) 
    ctx.drawImage(imageLegs, 300, 300, 300, 300) 
    ctx.drawImage(imageHead, 300, 10, 300, 300) 
  }

  function initialiseCanvas() {
    // Initialise the canvas element
    let canvas = document.getElementById('canvas')
    let ctx = canvas.getContext('2d')

    // Drawing functions
    let headImg = document.getElementById('headImage')
    let legsImg = document.getElementById('legsImage')
    let armsImg = document.getElementById('armsImage')

    ctx.drawImage(armsImg, 20, 150, 300, 300)
    ctx.drawImage(legsImg, 300, 300, 300, 300)
    ctx.drawImage(headImg, 300, 10, 300, 300)

    return ctx
  } 

  initialiseCanvas()

  var link = document.createElement('a');
    link.innerHTML = 'download image';
    link.addEventListener('click', function(ev) {
      link.href = canvas.toDataURL();
      link.download = "mypainting.png";
    }, false);
document.body.appendChild(link);

  </script>
  </body>
</html>
